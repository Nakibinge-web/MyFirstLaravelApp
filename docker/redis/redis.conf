# Redis configuration for Laravel Financial Tracker
# Optimized for cache and session storage

# Network Configuration
bind 0.0.0.0
protected-mode no
port 6379

# Memory Management
# Set maximum memory to 256MB (adjust based on your needs)
maxmemory 256mb

# Eviction policy: Remove least recently used keys when memory limit is reached
# This is ideal for cache usage where old data can be safely removed
maxmemory-policy allkeys-lru

# Persistence Configuration
# Save the dataset to disk at specified intervals
# Format: save <seconds> <changes>
# Save after 900 seconds (15 minutes) if at least 1 key changed
save 900 1
# Save after 300 seconds (5 minutes) if at least 10 keys changed
save 300 10
# Save after 60 seconds if at least 10000 keys changed
save 60 10000

# RDB file name
dbfilename dump.rdb

# Directory where RDB snapshots will be saved
dir /data

# Compression
# Compress string objects using LZF when dumping .rdb databases
rdbcompression yes

# RDB checksum
# Enable CRC64 checksum for RDB files (slight performance cost but better integrity)
rdbchecksum yes

# Logging
# Log level: debug, verbose, notice, warning
loglevel notice

# Log to stdout (Docker will capture this)
logfile ""

# Performance Tuning
# Disable TCP backlog (let OS handle it)
tcp-backlog 511

# Close connection after client is idle for N seconds (0 to disable)
timeout 0

# Send TCP keepalives to detect dead connections
tcp-keepalive 300

# Append Only File (AOF) - Disabled for cache usage
# For cache, RDB snapshots are sufficient and more performant
appendonly no

# Slow log configuration
# Log queries slower than specified microseconds (10000 = 10ms)
slowlog-log-slower-than 10000
slowlog-max-len 128

# Latency monitoring
latency-monitor-threshold 100

# Memory optimization
# Active memory defragmentation (Redis 4.0+)
activedefrag yes
